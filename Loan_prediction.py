{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1713d811-7378-444a-86a2-8fac8b204f6d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import streamlit as st\n",
    "import pandas as pd\n",
    "import joblib\n",
    "import numpy as np\n",
    "\n",
    "# Load trained model and feature names\n",
    "model = joblib.load(\"logistic_model.pkl\")\n",
    "training_features = joblib.load(\"training_features.pkl\")  # saved list of features used in training\n",
    "\n",
    "st.title(\"ðŸ  Dream Housing Loan Eligibility Checker\")\n",
    "\n",
    "# Example inputs (only key features, engineered features will default to 0)\n",
    "ApplicantIncome = st.number_input(\"Applicant Income\", value=5000)\n",
    "CoapplicantIncome = st.number_input(\"Coapplicant Income\", value=0)\n",
    "LoanAmount = st.number_input(\"Loan Amount\", value=150)\n",
    "Loan_Amount_Term = st.number_input(\"Loan Term (months)\", value=360)\n",
    "Credit_History = st.selectbox(\"Credit History\", [0, 1])\n",
    "Gender_Male = st.selectbox(\"Gender: Male?\", [0,1])\n",
    "Married_Yes = st.selectbox(\"Married?\", [0,1])\n",
    "Education_Not_Graduate = st.selectbox(\"Education: Not Graduate?\", [0,1])\n",
    "Self_Employed_Yes = st.selectbox(\"Self-Employed?\", [0,1])\n",
    "Property_Area_Semiurban = st.selectbox(\"Property Area: Semiurban?\", [0,1])\n",
    "Property_Area_Urban = st.selectbox(\"Property Area: Urban?\", [0,1])\n",
    "Dependents_1 = st.number_input(\"Dependents = 1\", value=0)\n",
    "Dependents_2 = st.number_input(\"Dependents = 2\", value=0)\n",
    "Dependents_3 = st.number_input(\"Dependents = 3\", value=0)\n",
    "\n",
    "# Create new applicant dictionary\n",
    "new_applicant_raw = {\n",
    "    \"ApplicantIncome\": ApplicantIncome,\n",
    "    \"CoapplicantIncome\": CoapplicantIncome,\n",
    "    \"LoanAmount\": LoanAmount,\n",
    "    \"Loan_Amount_Term\": Loan_Amount_Term,\n",
    "    \"Credit_History\": Credit_History,\n",
    "    \"Gender_Male\": Gender_Male,\n",
    "    \"Married_Yes\": Married_Yes,\n",
    "    \"Education_Not Graduate\": Education_Not_Graduate,\n",
    "    \"Self_Employed_Yes\": Self_Employed_Yes,\n",
    "    \"Property_Area_Semiurban\": Property_Area_Semiurban,\n",
    "    \"Property_Area_Urban\": Property_Area_Urban,\n",
    "    \"Dependents_1\": Dependents_1,\n",
    "    \"Dependents_2\": Dependents_2,\n",
    "    \"Dependents_3\": Dependents_3,\n",
    "    # Engineered features can default to 0\n",
    "    \"Total_Income\": ApplicantIncome + CoapplicantIncome,\n",
    "    \"Income_Loan_Ratio\": (ApplicantIncome + CoapplicantIncome)/LoanAmount if LoanAmount>0 else 0,\n",
    "    \"EMI\": LoanAmount / Loan_Amount_Term if Loan_Amount_Term>0 else 0,\n",
    "    \"Log_ApplicantIncome\": np.log(ApplicantIncome) if ApplicantIncome>0 else 0,\n",
    "    \"Log_LoanAmount\": np.log(LoanAmount) if LoanAmount>0 else 0\n",
    "}\n",
    "\n",
    "# Align with training features\n",
    "new_applicant = pd.DataFrame([{feat: new_applicant_raw.get(feat, 0) for feat in training_features}])\n",
    "\n",
    "# Predict probability and class\n",
    "eligibility_prob = model.predict_proba(new_applicant)[:, 1][0]\n",
    "eligibility_class = model.predict(new_applicant)[0]\n",
    "\n",
    "# Classy output\n",
    "st.markdown(f\"### Loan Eligibility: {'Eligible' if eligibility_class==1 else 'Not Eligible'}\")\n",
    "st.markdown(f\"###  Approval Probability: {eligibility_prob*100:.1f}%\")\n",
    "\n",
    "if eligibility_class == 1:\n",
    "    st.success(\"Congratulations! Applicant meets the loan criteria.\")\n",
    "else:\n",
    "    st.warning(\" Applicant does not meet eligibility criteria.\")\n",
    "\n",
    "# Show top features impacting decision\n",
    "coefficients = model.coef_[0]\n",
    "feature_impact = sorted(zip(training_features, coefficients), key=lambda x: abs(x[1]), reverse=True)\n",
    "\n",
    "st.markdown(\"###  Top Feature Contributions:\")\n",
    "for feat, coef in feature_impact[:8]:  # show top 8 features\n",
    "    sign = \"positive\" if coef > 0 else \"negative\"\n",
    "    st.markdown(f\"- {feat}: {sign} contribution ({coef:.3f})\")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:jupyter_env]",
   "language": "python",
   "name": "conda-env-jupyter_env-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.14"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
